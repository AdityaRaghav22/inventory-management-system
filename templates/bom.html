<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BOM Management</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <h1>BOM Management</h1>

  {% if message %}
    <p style="color: green;">{{ message }}</p>
  {% endif %}

  <!-- Select Product to View BOM -->
  <form method="get" action="/bom">
    <label>Select Product:</label>
    <select name="prod_name" required>
      <option value="">-- Choose Product --</option>
      {% for prod in all_products %}
        <option value="{{ prod }}" {% if selected_prod == prod %}selected{% endif %}>{{ prod }}</option>
      {% endfor %}
    </select>
    <button type="submit">View</button>
  </form>

  {% if selected_prod %}
    <h2>BOM for: {{ selected_prod }}</h2>

    <!-- Display current BOM -->
    {% if selected_bom %}
      <table border="1" cellpadding="5">
        <tr>
          <th>Component</th>
          <th>Quantity</th>
        </tr>
        {% for comp, qty in selected_bom.items() %}
        <tr>
          <td>{{ comp }}</td>
          <td>{{ qty }}</td>
        </tr>
        {% endfor %}
      </table>
    {% else %}
      <p>No BOM found.</p>
    {% endif %}

    <hr>

    <!-- Add Component -->
    <h3>Add Component</h3>
    <form method="post">
      <input type="hidden" name="action" value="add">
      <input type="hidden" name="prod_name" value="{{ selected_prod }}">
      <label>Component:</label>
      <select name="component" required>
        <option value="">-- Select --</option>
        {% for comp in all_inventory %}
          <option value="{{ comp }}">{{ comp }}</option>
        {% endfor %}
      </select>
      <label>Quantity:</label>
      <input type="number" step="0.01" name="quantity" required>
      <button type="submit">Add</button>
    </form>

    <!-- Update Component -->
    <h3>Update Component Quantity</h3>
    <form method="post">
      <input type="hidden" name="action" value="update">
      <input type="hidden" name="prod_name" value="{{ selected_prod }}">
      <label>Component:</label>
      <select name="component" required>
        {% for comp in selected_bom.keys() %}
          <option value="{{ comp }}">{{ comp }}</option>
        {% endfor %}
      </select>
      <label>New Quantity:</label>
      <input type="number" step="0.01" name="quantity" required>
      <button type="submit">Update</button>
    </form>

    <!-- Delete Component -->
    <h3>Delete Component</h3>
    <form method="post">
      <input type="hidden" name="action" value="delete">
      <input type="hidden" name="prod_name" value="{{ selected_prod }}">
      <label>Component:</label>
      <select name="component" required>
        {% for comp in selected_bom.keys() %}
          <option value="{{ comp }}">{{ comp }}</option>
        {% endfor %}
      </select>
      <button type="submit" style="color: red;">Delete</button>
    </form>

    <!-- Delete Full BOM -->
    <h3>Delete Entire BOM</h3>
    <form method="post" onsubmit="return confirm('Are you sure you want to delete the entire BOM?')">
      <input type="hidden" name="action" value="delete_bom">
      <input type="hidden" name="prod_name" value="{{ selected_prod }}">
      <button type="submit" style="color: red;">Delete BOM</button>
    </form>

    <!-- Check BOM Completeness -->
    <h3>Check BOM Completeness</h3>
    <form method="post">
      <input type="hidden" name="action" value="check">
      <input type="hidden" name="prod_name" value="{{ selected_prod }}">
      <button type="submit">Check Completeness</button>
    </form>
  {% endif %}
</body>
</html>
